---
title: "Programming Languages für Data Science"
subtitle: "Major Assignment: Flight Analysis - Data Exploration"
author: "Christian Roth & Andreas Waßmus"
date: "22.10.2019"
output:
    html_document:
    toc: true
    toc_depth: 3
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1 Problem Statement

Flight Analysis with the Flight Data from the USA in 2015. Conduct a descriptive Analysis. Doing some kind of inductive Statistics.


# 1.1 Libraries and Data

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(DataExplorer)
```

Loading the data:

```{r}
usflights <- read_csv("/Users/andreaswassmus/Documents/GitHub/Data for final Assignment/flights.csv")
```

```{r}
nrow(usflights)
```

The data contains 5.819.079 datasets (=count of flights in the US in 2015)


```{r}
head(usflights)
```

Important features for analysis:
Date
Airline
Flight_Number
Origin_Airport
Destination_Arport
Scheduled_Departure
Departure Time
Departure Delay


# Check of missing values

```{r}
#is.na(usflights)
colSums(is.na(usflights))
```


In the dataset there is a high amount of missing values in the features: cancellation_reason, air_system_delay, security_delay, airline_delay, late aircraft_delay, weather_delay. Since these colums are only explanations of the features cancellation and delay we can remove them from the dataset.


```{r}
usflights$CANCELLATION_REASON <- NULL
usflights$AIR_SYSTEM_DELAY <- NULL
usflights$SECURITY_DELAY <- NULL
usflights$AIRLINE_DELAY <- NULL
usflights$LATE_AIRCRAFT_DELAY <- NULL
usflights$WEATHER_DELAY <- NULL
head(usflights, 3)
```


```{r}
colSums(is.na(usflights))
```

For the analysis it is important to have complete datasets. Therefore, 3 columns will be deleted to have only complete observations. (airtime_delay could be also calculated by "mutate". For simplification it is waived due to the large number of records)

```{r}
usflights_complete <- usflights[!is.na(usflights$DEPARTURE_TIME),]
usflights_complete <- usflights[!is.na(usflights$ARRIVAL_TIME),]
usflights_complete <- usflights[!is.na(usflights$ARRIVAL_DELAY),]
```

```{r}
colSums(is.na(usflights_complete))
```

```{r}
nrow(usflights_complete)
```

105.071 data sets were reomved from the analyse. The data has now 5.714.008 oberservations.

Data Cleaning End


# Merge with Arilines und Airports

```{r}
airlines2015 <- read_csv("/Users/andreaswassmus/Documents/GitHub/Data for final Assignment/airlines(2015).csv")
airports2015 <- read_csv("/Users/andreaswassmus/Documents/GitHub/Data for final Assignment/airports(2015).csv")
```

```{r}
head(airports2015)
```


```{r}
head(airlines2015)
```


```{r}
colSums(is.na(airports2015))
```


```{r}
data_list_2015 <- list(airlines2015, airports2015, usflights)
plot_str(data_list_2015)
```



Wo fliegen die meisten Flugzeuge ab?

```{r}
plot_str(usflights_complete)
```









```{r}

```

Wie viel sind die Flüge bei Abflug verspätet?

```{r}
usflights_complete %>%
  summarise(DEPARTURE_DELAY = mean(DEPARTURE_DELAY))
```

Wie viel sind die Flüge im Durchscnitt bei Ankunft verspätet?

```{r}
usflights_complete %>%
  summarise(ARRIVAL_DELAY = mean(ARRIVAL_DELAY))
```


```{r}
p1 <- ggplot(usflights_complete, aes(DISTANCE, ARRIVAL_DELAY)) +
   geom_point() 
p1
```


```{r}
usflights_complete %>% 
select ("ARRIVAL_DELAY")
```


```{r}
max(usflights_complete$ARRIVAL_DELAY, na.rm = TRUE)
nrow(usflights_complete)
```



```{r}
usflights_complete %>% 
cor.test(usflights_compülete$ARRIVAL_DELAY, usflights_complete$DISTANCE)
```


Erster Einblick in die Verspätungen je Airline:

```{r}
p2<- ggplot(usflights_complete, aes(AIRLINE , ARRIVAL_DELAY)) +
   geom_boxplot() 
p2
```

```{r}
usflights_complete %>%
  count(AIRLINE) 
```




```{r}
usflights_complete %>%
  group_by(AIRLINE) %>%
  summarise (mean_arrival_delay = mean(ARRIVAL_DELAY),
            median_arrival_delay = median(ARRIVAL_DELAY),
            max_arrival_delay = max(ARRIVAL_DELAY),
            min_arrival_delay = min(ARRIVAL_DELAY))
```


```{r}
summary(usflights_complete$ARRIVAL_DELAY, na.rm = TRUE)
```


```{r}


usflights_complete %>% 
  group_by(DAY, MONTH) %>% 
  summarise(ARRIVAL_DELAY = mean(ARRIVAL_DELAY)) %>% 
  ungroup() %>%
  arrange(desc(ARRIVAL_DELAY))


```



BIVARIATE STATISTIK

```{r}


cor(usflights_complete$DISTANCE, usflights_complete$AIR_TIME, use = "pairwise.complete.obs", method = "pearson")


```

```{r}

cor(usflights_complete$DISTANCE, usflights_complete$AIR_TIME, use = "pairwise.complete.obs", method = "spearman")


```
Rechenintensiver, aber gleiches Ergebnis

ENcoding UTF-8




```{r}


library(ggplot2)


```



```{r}
p10 <- qplot(x = usflights_complete$DEPARTURE_DELAY, y = usflights_complete$ARRIVAL_DELAY, geom = "point",
                      xlab = "Departure Delay", ylab = "Arrival Delay", main = "Correlation Delays")
p10
```




Lineare Regression

```{r}

lm1 <- usflights_complete %>%
          filter(ORIGIN_AIRPORT == "JFK") %>%
          slice(1:10000000)
        
#glimpse(lm1)
  lm(AIR_TIME ~ DISTANCE + TAXI_IN + TAXI_OUT, data = usflights_complete)


```


```{r}
lm1
```



MEAN, MIN, MAX, MEDIAN IM GESAMTDATENSATZ


```{r}

mean(usflights_complete$ARRIVAL_DELAY, na.rm = TRUE)
min(usflights_complete$ARRIVAL_DELAY, na.rm = TRUE)
max(usflights_complete$ARRIVAL_DELAY, na.rm = TRUE)
median(usflights_complete$ARRIVAL_DELAY, na.rm = TRUE)


```





```{r}
usflights_complete_statistics  <-
  list("ARRIVAL_DELAY" =
       list("min" = ~ min(.usflights_complete$ARRIVAL_DELAY),
            "max" = ~ max(.data$mpg),
            "mean (sd)" = ~ qwraps2::mean_sd(.data$mpg)),
       )
```




```{r}
install.packages("DataExplorer")
```


```{r}
library(DataExplorer)
```



```{r}
plot_str(usflights_complete)
```


```{r}
introduce(usflights_complete)
```


```{r}
plot_intro(usflights_complete)
```




```{r}
plot_bar(usflights_complete)
```





```{r}
plot_bar(usflights_complete, with = "ARRIVAL_DELAY")
```






```{r}
plot_histogram(usflights_complete)
```








```{r}
qq_data <- usflights_complete[, c("ARRIVAL_DELAY", "AIR_TIME", "DISTANCE")]

plot_qq(qq_data, sampled_rows = 1000L)
```


```{r}
plot_correlation(na.omit(usflights_complete), maxcat = 10L)
```


```{r}
plot_correlation(na.omit(usflights_complete), type = "a")
```


```{r}
plot_histogram(usflights_complete, binary_as_factor = TRUE,
  geom_histogram_args = list(bins = 30L), title = NULL,
  theme_config = list(), nrow = 4L,
  ncol = 4L, parallel = FALSE)
```

```{r}

```


