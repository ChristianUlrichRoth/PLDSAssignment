---
title: "Programming Languages für Data Science"
subtitle: "Major Assignment: Flight Analysis - Data Exploration Christmas Data"
author: "Christian Roth & Andreas Waßmus"
date: "22.10.2019"
output:
    html_document:
    toc: true
    toc_depth: 3
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1 Data Exploration Christmas Flights 2015


## 1.1 Libraries and Data

```{r}
library(tidyverse)
library(readr)
library(DataExplorer)
```

## 1.2 Loading the data:

__Christmas15:__

```{r}
christmas15 <- read_csv( file=( "./data/cleandata/christmas15.csv"))
```

__ChristmasDay15:__

```{r}
christmasDay15 <- read_csv( file=( "./data/cleandata/christmasDay15.csv"))
```

Check data:

```{r}
head(christmas15)
head(christmasDay15)
```

How many flights are in the two data sets:

```{r}
nrow(christmas15)
nrow(christmasDay15)
```



# 2. Data Exploration Christmas Flights 2015

Quick Introduction christmas15 dataset:
(with DataExplorer, source: https://cran.r-project.org/web/packages/DataExplorer/vignettes/dataexplorer-intro.html)

We have 16 discrete and 17 continuous features.


```{r}
introduce(christmas15)
```

Quick Visualization of the metrics of the data and check missing values:

```{r}
plot_intro(christmas15)
```


With the following histograms you will get first insights in the distribution of each feature.

```{r}
plot_histogram(christmas15, binary_as_factor = TRUE,
  geom_histogram_args = list(bins = 30L), title = NULL,
  theme_config = list(), nrow = 4L,
  ncol = 4L, parallel = FALSE)
```



__Statistics on ARRIVAL_DELAY at Christmas (1)__

```{r}
summary(christmas15$ARRIVAL_DELAY, na.rm = TRUE)
```

All flights are on avarge around 13,5 min. delayed. The median states that 50% of the flights arrive one minute early. This means that there are long-delayed flights that negatively affect the mean. You can see this also in the long tail of the histogram ARRIVAL_DELAY. The same conclusion arises with the following values.

__Statistics on ARRIVAL_DELAY at Christmas (2)__

```{r}
christmas15 %>%
  group_by(AIRLINE) %>%
  summarise (mean_arrival_delay = mean(ARRIVAL_DELAY),
            median_arrival_delay = median(ARRIVAL_DELAY),
            max_arrival_delay = max(ARRIVAL_DELAY),
            min_arrival_delay = min(ARRIVAL_DELAY))
```

__Statistics on DEPARTURE_DELAY at Christmas (1)__


```{r}
summary(christmas15$DEPARTURE_DELAY, na.rm = TRUE)
```

__Statistics on DEPARTURE_DELAY at Christmas (2)__

```{r}
christmas15 %>%
  group_by(ORIGIN_AIRPORT) %>%
  filter(AIRLINE == "AA") %>%
  summarise (
    mean_departure_delay = mean(DEPARTURE_DELAY),
    median_departure_delay = median(DEPARTURE_DELAY),
    max_departure_delay = max(DEPARTURE_DELAY),
    min_departure_delay = min(DEPARTURE_DELAY)
  )
```

It would be interesting to analyze how departure and arrival are related and how much time aircraft can catch up during a flight. For reasons of time, this analysis is excluded from this project.


Some more statistics to explore the structure of the data

__QQ-plots:__

```{r}
qq_christmas15 <- christmas15[, c("ARRIVAL_DELAY", "AIR_TIME", "DISTANCE", "ELAPSED_TIME")]
plot_qq(qq_christmas15, sampled_rows = 1000L)
```

__QQ-Plots with log__

```{r}
log_qq_christmas15 <- update_columns(qq_christmas15, 2:4, function(x) log(x + 1))

plot_qq(log_qq_christmas15[, 2:4], sampled_rows = 1000L)
```

__Correlations__

The correlation plot gives a fast overview over the features which have a high correlation between each other. In our data we can find many correlations with ARRIVAL_DELAY.

```{r}
christmas15 %>%
  filter(ORIGIN_AIRPORT == "JFK")
  plot_correlation(na.omit(christmas15), maxcat = 5L)
```


Based on the correlations, a regression analysis can be conducted. Following code chunk is exemplary for a regression analysis. Before that, tests for normal distribution and multicolinearity should be conducted.

__Linear Regression__

```{r}

lm(ARRIVAL_DELAY ~ DISTANCE + TAXI_IN + TAXI_OUT + DEPARTURE_DELAY + DEPARTURE_DATE, data = christmas15)

```


# 3. Interesting aspects for a dashboard

The object of this project is the develop a Shiny dashborad. Therefore the statistical analysis was shortend. In this part intresting aspect for a Shiny Dashboard are calculated:

__DEPARTURE_DELAY per DAY__

```{r}
christmas15 %>% 
  group_by(DEPARTURE_DATE) %>% 
  summarise(DEPARTURE_DELAY = mean(DEPARTURE_DELAY)) %>% 
  ungroup() %>%
  arrange(desc(DEPARTURE_DELAY))
```

__DEPARTURE_DELAY per DAY AND AIRLINE__

```{r}
christmas15 %>% 
  group_by(DEPARTURE_DATE, AIRLINE.y) %>% 
  summarise(DEPARTURE_DELAY = mean(DEPARTURE_DELAY)) %>% 
  ungroup() %>%
  arrange(desc(DEPARTURE_DELAY))
```

__DEPARTURE_DELAY per AIRLINE (Chrismas Delay)__

```{r}
christmas15 %>% 
  group_by(AIRLINE.y) %>% 
  summarise(DEPARTURE_DELAY = mean(DEPARTURE_DELAY)) %>% 
  ungroup() %>%
  arrange(desc(DEPARTURE_DELAY))
```

__What airports have the highest DEPARTURE_DELAYs?__

```{r}
christmas15 %>% 
  group_by(ORIGIN_AIRPORT) %>% 
  summarise(meanDEPARTURE_DELAY = mean(DEPARTURE_DELAY)) %>% 
  ungroup() %>%
 arrange(desc(meanDEPARTURE_DELAY))
```

```{r}
head(christmas15)
```


__Overview on arrival and departure delay per airline (1)__


```{r}
christmas15 %>% 
    group_by(DEPARTURE_DATE) %>% 
    summarise_at(c("ARRIVAL_DELAY", "DEPARTURE_DELAY"), 
                 funs(mean(., na.rm = TRUE), median(., na.rm = TRUE)))
```

__Overview on arrival and departure delay per airline (2)__

```{r}
christmas15 %>% 
    group_by(AIRLINE) %>% 
    summarise_at(c("ARRIVAL_DELAY", "DEPARTURE_DELAY"), 
                 funs(mean(., na.rm = TRUE), median(., na.rm = TRUE)))
```


__Flights per airline__

```{r}
christmas15 %>% 
    group_by(AIRLINE, DEPARTURE_DATE) %>% 
    summarise(count = n())
```


__Count of delayed flights per airline__

```{r}
christmas15 %>% 
    group_by(AIRLINE, DEPARTURE_DATE) %>% 
    filter(DEPARTURE_DELAY > 0) %>% 
    summarise(count = n())

```








