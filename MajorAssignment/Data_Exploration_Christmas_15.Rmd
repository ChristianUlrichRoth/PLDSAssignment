---
title: "Programming Languages für Data Science"
subtitle: "Major Assignment: Flight Analysis - Data Exploration Christmas Data"
author: "Christian Roth & Andreas Waßmus"
date: "22.10.2019"
output:
    html_document:
    toc: true
    toc_depth: 3
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1 Data Exploration Christmas Flights 2015


## 1.1 Libraries and Data

```{r}
library(tidyverse)
library(readr)
library(DataExplorer)
```

## 1.2 Loading the data:

__Christmas15:__

```{r}
christmas15 <- read_csv( file=( "./data/cleandata/christmas15.csv"))
```

__ChristmasDay15:__

```{r}
christmasDay15 <- read_csv( file=( "./data/cleandata/christmasDay15.csv"))
```

Check data:

```{r}
head(christmas15)
head(christmasDay15)
```


```{r}
nrow(christmas15)
nrow(christmasDay15)
```



# 2. Data Exploration Christmas Flights 2015

Quick Introduction christmas15 dataset:
(with DataExplorer, source: https://cran.r-project.org/web/packages/DataExplorer/vignettes/dataexplorer-intro.html)

We have 16 discrete and 17 continuous features.


```{r}
introduce(christmas15)
```

Quick Visualization of the metrics of the data and check missing values:

```{r}
plot_intro(christmas15)
```


```{r}
plot_histogram(christmas15, binary_as_factor = TRUE,
  geom_histogram_args = list(bins = 30L), title = NULL,
  theme_config = list(), nrow = 4L,
  ncol = 4L, parallel = FALSE)
```





ARRIVAL_DELAY at Christmas

```{r}
summary(christmas15$ARRIVAL_DELAY, na.rm = TRUE)
```


```{r}
christmas15 %>%
  group_by(AIRLINE) %>%
  summarise (mean_arrival_delay = mean(ARRIVAL_DELAY),
            median_arrival_delay = median(ARRIVAL_DELAY),
            max_arrival_delay = max(ARRIVAL_DELAY),
            min_arrival_delay = min(ARRIVAL_DELAY))
```

DEPARTURE_DELAY at Christmas

```{r}
summary(christmas15$DEPARTURE_DELAY, na.rm = TRUE)
```

```{r}
startData %>%
  group_by(ORIGIN_AIRPORT) %>%
  filter(AIRLINE == "AA") %>%
  summarise (
    mean_departure_delay = mean(DEPARTURE_DELAY),
    median_departure_delay = median(DEPARTURE_DELAY),
    max_departure_delay = max(DEPARTURE_DELAY),
    min_departure_delay = min(DEPARTURE_DELAY)
  )
```

```{r}
head(startData)
```




QQ-plots:

```{r}
qq_christmas15 <- christmas15[, c("ARRIVAL_DELAY", "AIR_TIME", "DISTANCE", "ELAPSED_TIME")]
plot_qq(qq_christmas15, sampled_rows = 1000L)
```

QQ-Plots with log

```{r}
log_qq_christmas15 <- update_columns(qq_christmas15, 2:4, function(x) log(x + 1))

plot_qq(log_qq_christmas15[, 2:4], sampled_rows = 1000L)
```

## Bivariate statistics

The correlation plot gives a fast overview over the feature which have a high correlation between each other. In our analysis the following features coherency:
DISTANCE, ELAPSED_TIME, AIR_TIME, DISTANCE

ARRIVAL_DELAY AND DEPARTURE_DELAY, TAXI_IN, TAXI_OUT, SCHEDULED_TIME, DISTANCE, DEPARTURE_DATE,

```{r}
christmas15 %>%
  filter(ORIGIN_AIRPORT == "JFK")
  plot_correlation(na.omit(christmas15), maxcat = 5L)
```

BASIEREND AUF dieser ANALYSE eine Regression

Lineare Regression

```{r}

#lm1 <- christmas15 %>%
 #        filter(ORIGIN_AIRPORT == "JFK") %>%
  #       slice(1:50000)

lm(ARRIVAL_DELAY ~ DISTANCE + TAXI_IN + TAXI_OUT + DEPARTURE_DELAY + DEPARTURE_DATE, data = christmas15)


```



Correlation between departure and arrival?

BIVARIATE STATISTIK


```{r}
plot_correlation(na.omit(christmasDay15), type = "a")
```




## DEPARTURE_DELAY per DAY

```{r}
christmas15 %>% 
  group_by(DEPARTURE_DATE) %>% 
  summarise(DEPARTURE_DELAY = mean(DEPARTURE_DELAY)) %>% 
  ungroup() %>%
  arrange(desc(DEPARTURE_DELAY))
```

## DEPARTURE_DELAY per DAY AND AIRLINE

```{r}
christmas15 %>% 
  group_by(DEPARTURE_DATE, AIRLINE.y) %>% 
  summarise(DEPARTURE_DELAY = mean(DEPARTURE_DELAY)) %>% 
  ungroup() %>%
  arrange(desc(DEPARTURE_DELAY))
```

## DEPARTURE_DELAY per AIRLINE (Chrismas Delay)

```{r}
christmas15 %>% 
  group_by(AIRLINE.y) %>% 
  summarise(DEPARTURE_DELAY = mean(DEPARTURE_DELAY)) %>% 
  ungroup() %>%
  arrange(desc(DEPARTURE_DELAY))
```

## Welcher DESTINATION hat die meiste Verspätung?

```{r}
christmas15 %>% 
  group_by(DESTINATION_AIRPORT) %>% 
  summarise(DEPARTURE_DELAY = mean(DEPARTURE_DELAY)) %>% 
  ungroup() %>%
  arrange(desc(DEPARTURE_DELAY))
```

## Mean and Median (Departure and Arival) on each day


```{r}
christmas15 %>% 
    group_by(DEPARTURE_DATE) %>% 
    summarise_at(c("ARRIVAL_DELAY", "DEPARTURE_DELAY"), 
                 funs(mean(., na.rm = TRUE), median(., na.rm = TRUE)))
```



```{r}
christmas15 %>% 
    group_by(AIRLINE) %>% 
    summarise_at(c("ARRIVAL_DELAY", "DEPARTURE_DELAY"), 
                 funs(mean(., na.rm = TRUE), median(., na.rm = TRUE)))
```



Anzahl verspäteter Flüge je Airline:

```{r}
startData %>% 
    group_by(AIRLINE, DEPARTURE_DATE) %>% 
    filter(DEPARTURE_DELAY > 0) %>% 
    summarise(count = n())

```


```{r}
christmas15 %>% 
    group_by(AIRLINE, DEPARTURE_DATE) %>% 
    summarise(count = n())
```



```{r}


cor(flights2015_delay10$DEPARTURE_DELAY, flights2015_delay10$ARRIVAL_DELAY, use = "pairwise.complete.obs", method = "pearson")


```

```{r}

cor(flights2015_delay10$DISTANCE, flights2015_delay10$AIR_TIME, use = "pairwise.complete.obs", method = "spearman")


```






```{r}

```



```{r}

```



```{r}

```



```{r}

```



```{r}

```

